<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Planning Tool</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useRef } = React;

        const ProjectPlannerTool = () => {
          const [step, setStep] = useState(1);
          const [projectName, setProjectName] = useState('');
          const [goLiveDate, setGoLiveDate] = useState('');
          const [projectWeeks, setProjectWeeks] = useState(18);
          const [tasks, setTasks] = useState([]);
          const [calendarFilter, setCalendarFilter] = useState('all');
          const fileInputRef = useRef(null);

          const taskTypes = ['Build', 'Testing', 'Training', 'Planning', 'Milestone'];

          const calculateProjectStart = (goLive, weeks) => {
            if (!goLive) return null;
            const date = new Date(goLive);
            let businessDays = (weeks * 5) - 1;
            while (businessDays > 0) {
              date.setDate(date.getDate() - 1);
              if (date.getDay() !== 0 && date.getDay() !== 6) businessDays--;
            }
            while (date.getDay() !== 1) date.setDate(date.getDate() - 1);
            return date;
          };

          const projectStartDate = calculateProjectStart(goLiveDate, projectWeeks);

          const getMondayOfWeek = (weekNum) => {
            if (!projectStartDate) return null;
            const date = new Date(projectStartDate);
            let businessDays = (weekNum - 1) * 5;
            while (businessDays > 0) {
              date.setDate(date.getDate() + 1);
              if (date.getDay() !== 0 && date.getDay() !== 6) businessDays--;
            }
            return date;
          };

          const calculateEndDate = (startDate, duration, durationType) => {
            const date = new Date(startDate);
            let daysToAdd = durationType === 'weeks' ? duration * 5 : duration;
            let added = 0;
            while (added < daysToAdd - 1) {
              date.setDate(date.getDate() + 1);
              if (date.getDay() !== 0 && date.getDay() !== 6) added++;
            }
            return date;
          };

          const downloadTemplate = () => {
            const templateData = [{
              'Task Name': 'Example Task',
              'Task Details': 'Description of the task',
              'Start Week': 1,
              'Duration': 2,
              'Duration Type': 'weeks',
              'Exact Date Required': 'No',
              'Task Type': 'Build'
            }];
            const ws = XLSX.utils.json_to_sheet(templateData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Tasks');
            XLSX.writeFile(wb, 'project_planning_template.xlsx');
          };

          const handleFileUpload = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
              const data = new Uint8Array(event.target.result);
              const workbook = XLSX.read(data, { type: 'array' });
              const sheet = workbook.Sheets[workbook.SheetNames[0]];
              const jsonData = XLSX.utils.sheet_to_json(sheet);
              const parsed = jsonData.map((row, i) => ({
                id: `task-${Date.now()}-${i}`,
                name: row['Task Name'] || '',
                details: row['Task Details'] || '',
                startWeek: parseInt(row['Start Week']) || 1,
                duration: parseFloat(row['Duration']) || 1,
                durationType: (row['Duration Type'] || 'weeks').toLowerCase(),
                exactDateRequired: (row['Exact Date Required'] || '').toLowerCase() === 'yes',
                taskType: row['Task Type'] || 'Build',
                specificDate: null,
                owner: '',
                status: 'Not Started',
                percentComplete: 0,
                notes: ''
              }));
              setTasks(parsed);
              setStep(3);
            };
            reader.readAsArrayBuffer(file);
          };

          const addTask = () => setTasks([...tasks, {
            id: `task-${Date.now()}`,
            name: '',
            details: '',
            startWeek: 1,
            duration: 1,
            durationType: 'weeks',
            exactDateRequired: false,
            taskType: 'Build',
            specificDate: null,
            owner: '',
            status: 'Not Started',
            percentComplete: 0,
            notes: ''
          }]);

          const updateTask = (id, field, value) => {
            setTasks(tasks.map(t => t.id === id ? { ...t, [field]: value } : t));
          };

          const deleteTask = (id) => setTasks(tasks.filter(t => t.id !== id));

          const saveProgress = () => {
            const data = { projectName, goLiveDate, projectWeeks, tasks };
            const jsonStr = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${projectName || 'project'}_progress.json`;
            a.click();
            URL.revokeObjectURL(url);
          };

          const loadProgress = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
              try {
                const data = JSON.parse(event.target.result);
                setProjectName(data.projectName || '');
                setGoLiveDate(data.goLiveDate || '');
                setProjectWeeks(data.projectWeeks || 18);
                setTasks(data.tasks || []);
                setStep(4);
              } catch {
                alert('Error loading file. Please make sure it is a valid project file.');
              }
            };
            reader.readAsText(file);
          };

          const groupTasksByWeek = () => {
            const grouped = {};
            tasks.forEach(t => {
              if (!grouped[t.startWeek]) grouped[t.startWeek] = [];
              grouped[t.startWeek].push(t);
            });
            Object.keys(grouped).forEach(w => {
              grouped[w].sort((a, b) => {
                const aStart = a.specificDate ? new Date(a.specificDate) : getMondayOfWeek(a.startWeek);
                const bStart = b.specificDate ? new Date(b.specificDate) : getMondayOfWeek(b.startWeek);
                return calculateEndDate(aStart, a.duration, a.durationType) - 
                       calculateEndDate(bStart, b.duration, b.durationType);
              });
            });
            return grouped;
          };

          const exportToExcel = () => {
            const wb = XLSX.utils.book_new();
            
            const taskData = tasks.map(t => {
              const start = t.specificDate ? new Date(t.specificDate) : getMondayOfWeek(t.startWeek);
              const end = calculateEndDate(start, t.duration, t.durationType);
              return {
                'Week': `Week ${t.startWeek}`,
                'Task Type': t.taskType,
                'Task Name': t.name,
                'Details': t.details,
                'Start Date': start?.toLocaleDateString(),
                'End Date': end?.toLocaleDateString(),
                'Duration': `${t.duration} ${t.durationType}`,
                'Owner': t.owner,
                'Status': t.status,
                '% Complete': t.percentComplete,
                'Notes': t.notes
              };
            });
            XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(taskData), 'Task Tracker');
            
            const gantt = tasks.map(t => {
              const start = t.specificDate ? new Date(t.specificDate) : getMondayOfWeek(t.startWeek);
              const end = calculateEndDate(start, t.duration, t.durationType);
              return {
                'Task': t.name,
                'Start': start?.toLocaleDateString(),
                'End': end?.toLocaleDateString(),
                'Type': t.taskType
              };
            });
            XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(gantt), 'Gantt Chart');
            
            XLSX.writeFile(wb, `${projectName || 'project'}_tracker.xlsx`);
          };

          const renderCalendar = () => {
            if (!projectStartDate || !goLiveDate) return null;
            const months = [];
            let current = new Date(projectStartDate.getFullYear(), projectStartDate.getMonth(), 1);
            const end = new Date(goLiveDate);
            while (current <= end) {
              months.push(new Date(current));
              current.setMonth(current.getMonth() + 1);
            }

            const filtered = calendarFilter === 'all' ? tasks : tasks.filter(t => t.taskType === calendarFilter);

            return months.map(monthDate => {
              const year = monthDate.getFullYear();
              const month = monthDate.getMonth();
              const firstDay = new Date(year, month, 1);
              const lastDay = new Date(year, month + 1, 0);
              const days = [];
              for (let i = 0; i < firstDay.getDay(); i++) days.push(null);
              for (let i = 1; i <= lastDay.getDate(); i++) days.push(new Date(year, month, i));

              return (
                <div key={month} className="mb-8 bg-white rounded-lg p-6 shadow-sm">
                  <h3 className="text-lg font-semibold mb-4">
                    {monthDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}
                  </h3>
                  <div className="grid grid-cols-7 gap-1">
                    {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(d => (
                      <div key={d} className="text-center text-xs font-semibold text-gray-600 p-2">{d}</div>
                    ))}
                    {days.map((day, i) => {
                      const tasksOnDay = day ? filtered.filter(t => {
                        const start = t.specificDate ? new Date(t.specificDate) : getMondayOfWeek(t.startWeek);
                        const end = calculateEndDate(start, t.duration, t.durationType);
                        return day >= start && day <= end;
                      }) : [];
                      return (
                        <div key={i} className="border border-gray-200 min-h-20 p-1 bg-gray-50">
                          {day && (
                            <>
                              <div className="text-xs font-medium mb-1">{day.getDate()}</div>
                              {tasksOnDay.map((t, idx) => (
                                <div key={idx} className="text-xs bg-blue-100 text-blue-800 px-1 py-0.5 rounded mb-1 truncate" 
                                     title={t.name}>{t.name}</div>
                              ))}
                            </>
                          )}
                        </div>
                      );
                    })}
                  </div>
                </div>
              );
            });
          };

          return (
            <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 p-6">
              <div className="max-w-7xl mx-auto">
                <div className="bg-white rounded-xl shadow-lg p-8 mb-6">
                  <div className="flex items-center justify-between mb-8">
                    <h1 className="text-4xl font-bold text-gray-900">Project Planning Tool</h1>
                    <div className="flex items-center gap-3">
                      <span className="text-sm text-gray-600">Step {step} of 6</span>
                      {step > 2 && (
                        <button onClick={saveProgress} className="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                          üíæ Save Progress
                        </button>
                      )}
                    </div>
                  </div>

                  {step === 1 && (
                    <div className="space-y-6">
                      <h2 className="text-2xl font-bold text-gray-800">Getting Started</h2>
                      <p className="text-gray-600">This tool guides you through creating a comprehensive project plan.</p>
                      <ol className="list-decimal list-inside space-y-2 text-gray-600 ml-4">
                        <li>Download the task template spreadsheet</li>
                        <li>Fill in your project tasks</li>
                        <li>Upload the completed spreadsheet</li>
                        <li>Configure dates and review tasks</li>
                        <li>Generate visualizations and export</li>
                      </ol>
                      <div className="bg-blue-50 p-4 rounded-lg">
                        <h4 className="font-semibold text-blue-900 mb-2">Template Columns:</h4>
                        <ul className="text-sm text-blue-800 space-y-1">
                          <li><strong>Task Name, Details</strong></li>
                          <li><strong>Start Week:</strong> 1-{projectWeeks}</li>
                          <li><strong>Duration & Type:</strong> weeks or days</li>
                          <li><strong>Exact Date Required:</strong> Yes/No</li>
                          <li><strong>Task Type:</strong> Build, Testing, Training, Planning, Milestone</li>
                        </ul>
                      </div>
                      <button onClick={downloadTemplate} 
                        className="flex items-center gap-2 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors">
                        ‚¨áÔ∏è Download Template
                      </button>
                    </div>
                  )}

                  {step === 2 && (
                    <div className="text-center space-y-6">
                      <h2 className="text-2xl font-bold text-gray-800">Upload Your Data</h2>
                      <div className="text-6xl">üì§</div>
                      <div className="flex flex-col gap-4 items-center">
                        <button onClick={() => fileInputRef.current?.click()}
                          className="flex items-center gap-2 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors">
                          üìä Upload Task Spreadsheet
                        </button>
                        <button onClick={() => document.getElementById('jsonUpload')?.click()}
                          className="flex items-center gap-2 bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 transition-colors">
                          üìÅ Load Saved Project
                        </button>
                      </div>
                      <input ref={fileInputRef} type="file" accept=".xlsx,.xls" onChange={handleFileUpload} className="hidden" />
                      <input id="jsonUpload" type="file" accept=".json" onChange={loadProgress} className="hidden" />
                      <div className="bg-blue-50 p-4 rounded-lg text-left">
                        <h4 className="font-semibold text-blue-900 mb-2">How to Load Saved Project:</h4>
                        <ol className="text-sm text-blue-800 list-decimal list-inside space-y-1">
                          <li>Click "Load Saved Project"</li>
                          <li>Select your .json file</li>
                          <li>Continue editing</li>
                        </ol>
                      </div>
                    </div>
                  )}

                  {step === 3 && (
                    <div className="space-y-6">
                      <h2 className="text-2xl font-bold text-gray-800">Project Details</h2>
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">Project Name</label>
                        <input type="text" value={projectName} onChange={(e) => setProjectName(e.target.value)}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
                      </div>
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">Go-Live Date</label>
                        <input type="date" value={goLiveDate} onChange={(e) => setGoLiveDate(e.target.value)}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
                      </div>
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">Project Duration (Weeks)</label>
                        <input type="number" value={projectWeeks} onChange={(e) => setProjectWeeks(parseInt(e.target.value) || 18)}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" min="1" />
                      </div>
                      {projectStartDate && (
                        <div className="p-4 bg-blue-50 rounded-lg">
                          <p className="text-sm text-blue-900">
                            <strong>Project Start:</strong> {projectStartDate.toLocaleDateString('en-US', 
                              { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                          </p>
                        </div>
                      )}
                    </div>
                  )}

                  {step === 4 && (
                    <div className="space-y-6">
                      <h2 className="text-2xl font-bold text-gray-800">Review and Edit Tasks</h2>
                      {Object.entries(groupTasksByWeek()).sort(([a], [b]) => parseInt(a) - parseInt(b)).map(([week, weekTasks]) => (
                        <div key={week} className="bg-gray-50 rounded-lg p-4">
                          <h3 className="text-lg font-semibold mb-3">Week {week}
                            {getMondayOfWeek(parseInt(week)) && 
                              ` - ${getMondayOfWeek(parseInt(week)).toLocaleDateString()}`}
                          </h3>
                          {weekTasks.map(t => (
                            <div key={t.id} className="bg-white p-4 rounded-lg mb-3 shadow-sm">
                              <div className="grid grid-cols-2 md:grid-cols-4 gap-3 mb-3">
                                <input type="text" placeholder="Task Name" value={t.name}
                                  onChange={(e) => updateTask(t.id, 'name', e.target.value)}
                                  className="px-3 py-2 border rounded text-sm focus:ring-2 focus:ring-blue-500" />
                                <select value={t.taskType} onChange={(e) => updateTask(t.id, 'taskType', e.target.value)}
                                  className="px-3 py-2 border rounded text-sm focus:ring-2 focus:ring-blue-500">
                                  {taskTypes.map(type => <option key={type}>{type}</option>)}
                                </select>
                                <input type="text" placeholder="Owner" value={t.owner}
                                  onChange={(e) => updateTask(t.id, 'owner', e.target.value)}
                                  className="px-3 py-2 border rounded text-sm focus:ring-2 focus:ring-blue-500" />
                                <select value={t.status} onChange={(e) => updateTask(t.id, 'status', e.target.value)}
                                  className="px-3 py-2 border rounded text-sm focus:ring-2 focus:ring-blue-500">
                                  <option>Not Started</option>
                                  <option>In Progress</option>
                                  <option>Complete</option>
                                </select>
                                <input type="number" placeholder="% Complete" value={t.percentComplete}
                                  onChange={(e) => updateTask(t.id, 'percentComplete', parseInt(e.target.value) || 0)}
                                  className="px-3 py-2 border rounded text-sm focus:ring-2 focus:ring-blue-500" min="0" max="100" />
                                <input type="number" placeholder="Duration" value={t.duration}
                                  onChange={(e) => updateTask(t.id, 'duration', parseFloat(e.target.value) || 1)}
                                  className="px-3 py-2 border rounded text-sm focus:ring-2 focus:ring-blue-500" />
                                <select value={t.durationType} onChange={(e) => updateTask(t.id, 'durationType', e.target.value)}
                                  className="px-3 py-2 border rounded text-sm focus:ring-2 focus:ring-blue-500">
                                  <option value="days">days</option>
                                  <option value="weeks">weeks</option>
                                </select>
                                {t.exactDateRequired && (
                                  <input type="date" value={t.specificDate || ''}
                                    onChange={(e) => {
                                      const sel = new Date(e.target.value);
                                      const ws = getMondayOfWeek(t.startWeek);
                                      const we = calculateEndDate(ws, 5, 'days');
                                      if (sel < ws || sel > we) {
                                        if (window.confirm(`Date outside Week ${t.startWeek}. Continue?`))
                                          updateTask(t.id, 'specificDate', e.target.value);
                                      } else updateTask(t.id, 'specificDate', e.target.value);
                                    }}
                                    className="px-3 py-2 border rounded text-sm focus:ring-2 focus:ring-blue-500" />
                                )}
                              </div>
                              <textarea placeholder="Details" value={t.details}
                                onChange={(e) => updateTask(t.id, 'details', e.target.value)}
                                className="w-full px-3 py-2 border rounded text-sm mb-2 focus:ring-2 focus:ring-blue-500" rows="2" />
                              <textarea placeholder="Notes" value={t.notes}
                                onChange={(e) => updateTask(t.id, 'notes', e.target.value)}
                                className="w-full px-3 py-2 border rounded text-sm mb-2 focus:ring-2 focus:ring-blue-500" rows="2" />
                              <button onClick={() => deleteTask(t.id)}
                                className="text-red-600 text-sm hover:text-red-800 flex items-center gap-1">
                                üóëÔ∏è Delete
                              </button>
                            </div>
                          ))}
                        </div>
                      ))}
                      <button onClick={addTask}
                        className="flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                        ‚ûï Add Task
                      </button>
                    </div>
                  )}

                  {step === 5 && (
                    <div className="space-y-6">
                      <h2 className="text-2xl font-bold text-gray-800">Calendar View</h2>
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">Filter by Task Type</label>
                        <select value={calendarFilter} onChange={(e) => setCalendarFilter(e.target.value)}
                          className="px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                          <option value="all">All Tasks</option>
                          {taskTypes.map(t => <option key={t} value={t}>{t}</option>)}
                        </select>
                      </div>
                      <div className="max-h-screen overflow-y-auto">{renderCalendar()}</div>
                    </div>
                  )}

                  {step === 6 && (
                    <div className="text-center space-y-6">
                      <h2 className="text-2xl font-bold text-gray-800">Export Project</h2>
                      <p className="text-gray-600">Your project is ready to export!</p>
                      <button onClick={exportToExcel}
                        className="flex items-center gap-2 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors mx-auto">
                        üìä Export to Excel
                      </button>
                      <div className="bg-blue-50 p-4 rounded-lg text-left">
                        <h4 className="font-semibold text-blue-900 mb-2">Excel Tracker Includes:</h4>
                        <ul className="text-sm text-blue-800 space-y-1">
                          <li>‚Ä¢ Task Tracker with all details</li>
                          <li>‚Ä¢ Gantt Chart visualization</li>
                          <li>‚Ä¢ Status tracking (Not Started/In Progress/Complete)</li>
                        </ul>
                      </div>
                    </div>
                  )}

                  <div className="flex justify-between mt-8 pt-6 border-t">
                    <button onClick={() => setStep(Math.max(1, step - 1))} disabled={step === 1}
                      className="flex items-center gap-2 px-4 py-2 border rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                      ‚óÄÔ∏è Previous
                    </button>
                    <button onClick={() => setStep(Math.min(6, step + 1))} disabled={step === 6 || (step === 2 && tasks.length === 0)}
                      className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                      Next ‚ñ∂Ô∏è
                    </button>
                  </div>
                </div>
              </div>
            </div>
          );
        };

        ReactDOM.render(<ProjectPlannerTool />, document.getElementById('root'));
    </script>
</body>
</html>
